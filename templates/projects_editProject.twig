{% extends "layout.twig" %}
{% block content %}
    <section class="edit_project" id="edit_project">

        <button class="button buttons" onclick="goBack()">Gå tilbake</button>

        <div>
            {% if User.isAdmin() == 1 %}
                <button class="button buttons" id="prosjektKnapper"
                        onclick="goBack()">
                    <img src="" alt=""> Gå tilbake
                </button>
            {% endif %}
        </div>

        <div class="container container_menu text" id="projekt_info">
            <h3>Rediger prosjekt</h3>
            <br>Prosjekt: <b>{{ project.getProjectName }}</b></br>
            {% for users in users %}
                {% if project.getProjectLeader == users.getUserId %}
                    <br>Prosjekt Leder: <b>{{ users.getFirstName }} {{ users.getLastName }}</b></br>
                {% endif %}
            {% endfor %}
            <br>Prosjekt starttid: <b>{{ project.getStartTime }} </b></br>
            <br>Prosjekt sluttid: <b>{{ project.getFinishTime }} </b></br>
        </div>

        <div class="container container_menu_lang text" id="project_members">
            <br><label>Medlemmer i dette prosjektet: </label></br>
            <table class="table">
                <tr>
                    <th>Bruker id</th>
                    <th>Fornavn</th>
                    <th>Etternavn</th>
                </tr>
                {% for members in members %}
                    <tr>
                        <td>{{ members.getUserID() }}</td>
                        <td>{{ members.getFirstName }}</td>
                        <td>{{ members.getLastName }}</td>
                    </tr>
                {% endfor %}
            </table>
        </div>

    </section>

    <section>

        <div class="container container_menu_form text" id="edit_project">
            <form method="post" id="project_edit_form">
                <br><label for="customer">Kunde:</label>
                <br><select name="customer" id="customer">
                    {% for customer in customers %}
                        <option value="{{ customer.getUserId() }}" {% if project.getCustomer() == customer.getUserId() %} selected {% endif %}>{{ customer.getLastName() }}, {{ customer.getFirstName() }} ({{ customer.getUsername() }}) </option>
                    {% endfor %}
                </select>
                <br><label for="startTime">Start tid</label>
                <br><input id="startTime" type="date" name="startTime" value="{{ project.getStartTime() }}" placeholder="dd.mm.åååå" maxlength=90 />
                <br><label for="finishTime">Slutt tid</label>
                <br><input id="finishTime" type="date" name="finishTime" value="{{ project.getFinishTime() }}" placeholder="dd.mm.åååå" maxlength=90 />
                <table>
                    <tr>
                        <td colspan="2">
                            <label>Status på prosjektet: </label>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" id="waiting" name="status" value="0" {% if project.getStatus() == 0 %} checked {% endif %}>
                        </td>
                        <td>
                            <label for="waiting">Ventende </label>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" id="active" name="status" value="1" {% if project.getStatus() == 1 %} checked {% endif %} >
                        </td>
                        <td>
                            <label for="active">Pågår </label>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="status" id="paused" value="2" {% if project.getStatus() == 2 %} checked {% endif %} >
                        </td>
                        <td>
                            <label for="paused">På pause </label>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="radio" name="status" id="cancelled" value="3" {% if project.getStatus() == 3 %} checked {% endif %} >
                        </td>
                        <td>
                            <label for="paused">Kansellert </label>
                        </td>
                    </tr>
                </table>
                <input type="hidden" value="{{ getMac("Project edit") }}" name="XSRFPreventionToken">
                <br><input type="submit" name="project_edit" id="reg_btn" value="Endre prosjekt"></br>
            </form>
        </div>

        <div class="container container_menu_form text" id="add_user_to_project">
            <form method="post" id="group_register_form">
                <br><label>Gruppenavn: </label>
                <br><input type="text" name="groupName" value="" placeholder="Gruppenavn" maxlength=45 required
                           id="groupName"/>
                {% if user.isAdmin %}
                    <br><label>Admin eller vanlig gruppe: </label>
                    <br><input type="radio" name="isAdmin" value="1" required>
                    <label>Admin</label><br>
                    <input type="radio" name="isAdmin" value="0" required>
                    <label>Vanlig</label><br>
                {% endif %}
                <select name="groupMembers[]" id="" class="form-control" multiple onfocus='this.size=10;'
                        onblur='this.size=10;' onchange='this.size=10; this.blur();'>
                    {% for empl in employees %}
                        <option value="{{ empl.getUserID() }}">{{ empl.getFirstName }} {{ empl.getLastName }}
                            ({{ empl.getUsername }})
                        </option>
                    {% endfor %}
                </select>
                <input type="hidden" value="{{ getMac("Add group") }}" name="XSRFPreventionToken">
                <br><input type="submit" name="group_add" id="reg_btn" value="Ny gruppe">
            </form>
        </div>

        <div class="container container_menu_form text" id="groups_list">
            <h4>Grupper tilhørende prosjektet:</h4>
            <table>
                <tr>
                    <th>
                        Gruppenavn
                    </th>
                    <th>
                        Gruppetype
                    </th>
                    <th>
                        Antall medlemmer
                    </th>
                </tr>
                {% for grp in groups %}
                <tr>
                <td>
                    <a href="group_edit.php?groupid={{ grp.getGroupID() }}">{{ grp.getGroupName }}</a>
                </td>
                {% if grp.isAdmin %}
                <td>
                    Admin gruppe
                </td>
                {% else %}
                <td>
                    Vanlig gruppe
                </td>
                {% endif %}
                    <td>
                        {{ grp.nrOfUsers }}
                    </td>
                </tr>
                {% endfor %}
            </table>

        </div>

        <div class="openContainerNoBorder text" id="delete_project">
            {% if user.isAdmin() %}
                <form method="post" onsubmit="return confirm('Er du sikker på å slette prosjektet?\n(Kan ikke angres i etterkant!)');">
                    <input type="hidden" value="{{ getMac("Delete project") }}" name="XSRFPreventionToken">
                    <input type="submit" name="project_delete" value="Slett prosjekt" class="delete"/>
                </form>
            {% endif %}
        </div>

    </section>

    <div class="container container_big_long text">
        <h5>Tilbakemeldinger fra database</h5>
        {% if session.getFlashBag.has('header') %}
            {% for header in session.getFlashBag.get('header', []) %}
                <h6>{{ header }}</h6>
            {% endfor %}
            {% for message in session.getFlashBag.get('message', []) %}
                <p>{{ message }}</p>
            {% endfor %}
        {% endif %}
    </div>

{% endblock %}